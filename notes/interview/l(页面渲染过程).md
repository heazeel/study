### 输入url到页面渲染完成之间发生了什么
#### 1 DNS域名解析
1. 浏览器缓存
2. 系统缓存，查找hosts文件
3. 路由器缓存，查看路由映射表
4. 将域名发送给本地DNS服务器，直到找到相应的IP地址，返回给浏览器

#### 2 TCP连接（三次握手）
1. 客户端->服务端：你好，我想跟你连接可以吗？（SYN=1,seq=x）

2. 客户端->服务端：可以，你确定要连接是吧？（SYN=1,ACK=1,seq=y,ack=x+1）

3. 客户端->服务端：确定，我们连接吧！（ACK=1,seq=x+1,ack=y+1）

![TCP三次握手](https://images2015.cnblogs.com/blog/1034346/201703/1034346-20170329145607592-1103856922.png)

* 序列号seq：占4个字节，用来标记数据段的顺序，TCP把连接中发送的所有数据字节都编上一个序号，第一个字节的编号由本地随机产生；给字节编上序号后，就给每一个报文段指派一个序号；序列号seq就是这个报文段中的第一个字节的数据编号。

* 确认号ack：占4个字节，期待收到对方下一个报文段的第一个数据字节的序号；序列号表示报文段携带数据的第一个字节的编号；而确认号指的是期望接收到下一个字节的编号；因此当前报文段最后一个字节的编号+1即为确认号。

* 确认ACK：占1位，仅当ACK=1时，确认号字段才有效。ACK=0时，确认号无效

* 同步SYN：连接建立时用于同步序号。当SYN=1，ACK=0时表示：这是一个连接请求报文段。若同意连接，则在响应报文段中使得SYN=1，ACK=1。因此，SYN=1表示这是一个连接请求，或连接接受报文。SYN这个标志位只有在TCP建产连接时才会被置1，握手完成后SYN标志位被置0。

* 终止FIN：用来释放一个连接。FIN=1表示：此报文段的发送方的数据已经发送完毕，并要求释放运输连接

* PS：ACK、SYN和FIN这些大写的单词表示标志位，其值要么是1，要么是0；ack、seq小写的单词表示序号。

![字段含义](https://img2018.cnblogs.com/blog/1454483/201906/1454483-20190629132816032-2043402666.png)

#### 3 发送HTTP请求，接受HTTP响应
OK，连接上了，传输吧，这时就需要将用户输入的地址封装成HTTP Request请求报文，发送到服务器，服务器收到请求后会发出应答，即响应数据。

* HTTP请求报文格式：请求行+请求头+空行+消息体，请求行包括请求方式（GET/POST/DELETE/PUT）、请求资源路径（URL）、HTTP版本号；

* HTTP响应报文格式：状态行+响应头+空行+消息体，状态行包括HTTP版本号、状态码、状态说明。

**状态码分类表**

| 类别 | 原因短语 |
| ---- | ------- |
| 1xx |	Informational（信息性状态码）	接受的请求正在处理
| 2xx |  Success（成功状态码）	请求正常处理完毕
| 3xx |  Redirection（重定向）	需要进行附加操作以完成请求
| 4xx |	Client error（客户端错误）	客户端请求出错，服务器无法处理请求
| 5xx |	Server Error（服务器错误）	服务器处理请求出错

**200 OK**：表示从客户端发送给服务器的请求被正常处理并返回；

**204 No Content**：表示客户端发送给服务端的请求得到了成功处理，但在返回的响应报文中不含实体的主体部分（没有资源可以返回）；

**206 Patial Content**：表示客户端进行了范围请求，并且服务器成功执行了这部分的GET请求，响应报文中包含由Content-Range指定范围的实体内容。

**301 Moved Permanently**：永久性重定向，表示请求的资源被分配了新的URL，之后应使用更改的URL；

**302 Found**：临时性重定向，表示请求的资源被分配了新的URL，希望本次访问使用新的URL；

       301与302的区别：前者是永久移动，后者是临时移动（之后可能还会更改URL）

**303 See Other**：表示请求的资源被分配了新的URL，应使用GET方法定向获取请求的资源；

      302与303的区别：后者明确表示客户端应当采用GET方式获取资源

**304 Not Modified**：表示客户端发送附带条件（是指采用GET方法的请求报文中包含if-Match、If-Modified-Since、If-None-Match、If-Range、If-Unmodified-Since中任一首部）的请求时，服务器端允许访问资源，但是请求为满足条件的情况下返回改状态码；

**307 Temporary Redirect**：临时重定向，与303有着相同的含义，307会遵照浏览器标准不会从POST变成GET；（不同浏览器可能会出现不同的情况）；

**400 Bad Request**：表示请求报文中存在语法错误；

**401 Unauthorized**：未经许可，需要通过HTTP认证；

**403 Forbidden**：服务器拒绝该次访问（访问权限出现问题）

**404 Not Found**：表示服务器上无法找到请求的资源，除此之外，也可以在服务器拒绝请求但不想给拒绝原因时使用；

**500 Inter Server Error**：表示服务器在执行请求时发生了错误，也有可能是web应用存在的bug或某些临时的错误时；

**503 Server Unavailable**：表示服务器暂时处于超负载或正在进行停机维护，无法处理请求；

#### 4 浏览器解析HTML代码，请求js，css等资源，最后进行页面渲染，呈现给用户

浏览器获取文件后开始利用内核解析了，解析过程中也会出现一些HTTP请求请求一些资源，如js，css等文件，将这些文件下载到本地。浏览器解析HTML文件时会自上而下，起初产生一个DOM树，解析CSS之后产生CSS规则树，后将两树进行融合，合成为渲染层，最后调用操作系统的Native GUI的API绘制。

#### 5 断开TCP连接（四次挥手）
1. 客户端->服务端：好了，咱们断开吧（FIN=1,seq=u）

2. 服务端->客户端：行，等我稍微检查一下还有没有要发你的数据（ACK=1,seq=v,ack=u+1）

3. 服务端->客户端：可以了，咱们断开吧，拜拜（FIN=1,ACK=1,seq=w,ack=u+1）

4. 客户端->服务端：好的，再会，拜拜（ACK=1,seq=u+1,ack=w+1）

![四次挥手](https://images2015.cnblogs.com/blog/1034346/201703/1034346-20170329153945389-2019926409.png)